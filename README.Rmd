---
output:
  md_document:
    variant: markdown_github
---

dgirt is an R package for dynamic group-level IRT models as developed in
[Caughey and Warshaw 2014](http://pan.oxfordjournals.org/content/early/2015/02/04/pan.mpu021.full.pdf+html):

> Over the past eight decades, millions of people have been surveyed on their
> political opinions. Until recently, however, polls rarely included enough
> questions in a given domain to apply scaling techniques such as IRT models at
> the individual level, preventing scholars from taking full advantage of
> historical survey data. To address this problem, we develop a Bayesian
> group-level IRT approach that models latent traits at the level of demographic
> and/or geographic groups rather than individuals. We use a hierarchical model
> to borrow strength cross-sectionally and dynamic linear models to do so across
> time. The group-level estimates can be weighted to generate estimates for
> geographic units. This framework opens up vast new areas of research on
> historical public opinion, especially at the subnational level.

```{r, knitr-options, echo = FALSE}
# rmarkdown::render("~/projects/dgirt/README.Rmd")
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-",
  cache = FALSE)
```

# Quick start

Install from GitHub. `dgirt` requires [RStan](https://github.com/stan-dev/rstan).
See the RStan [installation instructions](https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started#how-to-install-rstan)
for help.
```
devtools::install_github("jamesdunham/dgirt", dependencies = TRUE)
```

Shape item response data for modeling:
```{r}
library(dgirt)
dgirt_in <- shape(state_opinion, item_names = "Q_cces2006_minimumwage",
                  time_name = "year", geo_name = "state", group_names = "race",
                  time_filter = 2006:2008, geo_filter = c("MA", "NY"),
                  survey_name = "source", weight_name = "weight")
```

Summarize the data:
```{r}
summary(dgirt_in)
```

Get item response counts:
```{r}
get_item_n(dgirt_in, by = "year")

```

Or response counts generally:
```{r}
get_n(dgirt_in, by = c("year", "source"))
```

Fit a DGIRT model:
```{r, results = 'hide', message = FALSE, warning = FALSE}
dgirt_out <- dgirt(dgirt_in, iter = 2000, chains = 2, cores = 2, seed = 42)
# verbose output omitted
```

All `rstan` methods for the `stanfit` class are available for `dgirt` output, so
[do things the RStan way](https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started#how-to-use-rstan).
Descriptive labels for parameters on time periods, local geographic areas, and
grouping variables will be added to most output.

Summarize the results:
```{r}
summary(dgirt_out, pars = "theta_bar", probs = NULL)[[1]][, c("n_eff", "Rhat")]
```

Get posterior means with a convenience function:
```{r}
get_posterior_mean(dgirt_out, pars = "theta_bar")
```

Or generally access posterior samples:
```{r}
apply(as.array(dgirt_out, pars = "theta_bar"), 3, mean)
```

See `help("dgirtfit-class")` and `help("stanfit-class")` for more.
