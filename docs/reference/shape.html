<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title><code>shape</code>: prepare data for modeling with <code>dgirt</code> or <code>dgmrp</code> — shape • dgo</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">dgo</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/policy_liberalism.html">Policy Liberalism</a>
</li>
<li>
  <a href="../articles/abortion_attitudes.html">Abortion Attitudes</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/jamesdunham/dgo">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1><code>shape</code>: prepare data for modeling with <code>dgirt</code> or <code>dgmrp</code></h1>
    </div>

    
    <p>This function shapes data for use in a dgirt or dgmrp model. Most
arguments give the name or names of key variables in the data. These
arguments end in <code>_name</code> or <code>_names</code> and should be character
vectors.</p>
    

    <pre class="usage"><span class='fu'>shape</span>(<span class='no'>item_data</span>, <span class='no'>item_names</span>, <span class='no'>time_name</span>, <span class='no'>geo_name</span>, <span class='kw'>group_names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>id_vars</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>time_filter</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>geo_filter</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>min_t_filter</span> <span class='kw'>=</span> <span class='fl'>1L</span>, <span class='kw'>min_survey_filter</span> <span class='kw'>=</span> <span class='fl'>1L</span>, <span class='kw'>survey_name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>modifier_data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>modifier_names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>t1_modifier_names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>standardize</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>target_data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>raking</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>weight_name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>proportion_name</span> <span class='kw'>=</span> <span class='st'>"proportion"</span>,
  <span class='kw'>aggregate_data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>aggregate_item_names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>constant_item</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>item_data</th>
      <td><p>A table in which items appear in columns and each row
represents an individual's responses in some time period and local geographic
area.</p></td>
    </tr>
    <tr>
      <th>item_names</th>
      <td><p>Item response variables.</p></td>
    </tr>
    <tr>
      <th>time_name</th>
      <td><p>A time variable with numeric values.</p></td>
    </tr>
    <tr>
      <th>geo_name</th>
      <td><p>A geographic variable representing local areas.</p></td>
    </tr>
    <tr>
      <th>group_names</th>
      <td><p>Discrete grouping variables, usually demographic. Using
numeric variables is allowed but not recommended.</p></td>
    </tr>
    <tr>
      <th>id_vars</th>
      <td><p>Additional variables that should be included in the result,
other than those specified elsewhere.</p></td>
    </tr>
    <tr>
      <th>time_filter</th>
      <td><p>A numeric vector giving possible values of the time
variable. Observed and unobserved time periods can be given. Defaults to
observed values.</p></td>
    </tr>
    <tr>
      <th>geo_filter</th>
      <td><p>A character vector giving values of the geographic
variable. Defaults to observed values.</p></td>
    </tr>
    <tr>
      <th>min_t_filter</th>
      <td><p>An integer minimum of time period appearances for
included items.</p></td>
    </tr>
    <tr>
      <th>min_survey_filter</th>
      <td><p>An integer minimum of survey appearances for
included items.</p></td>
    </tr>
    <tr>
      <th>survey_name</th>
      <td><p>A survey identifier.</p></td>
    </tr>
    <tr>
      <th>modifier_data</th>
      <td><p>Table giving characteristics of local geographic areas
in time periods. See details below.</p></td>
    </tr>
    <tr>
      <th>modifier_names</th>
      <td><p>Variables giving modifiers of geographic hierarchical
parameters in <code>modifier_data</code>.</p></td>
    </tr>
    <tr>
      <th>t1_modifier_names</th>
      <td><p>Variables to be used instead of those in
<code>modifier_names</code>, only in the first period.</p></td>
    </tr>
    <tr>
      <th>standardize</th>
      <td><p>Whether to standardize the variables given by
<code>modifier_names</code> and <code>t1_modifier_names</code> to be zero-mean and
unit-variance for performance gains. (For discussion see the Stan Language
Reference section "Standardizing Predictors and Outputs.")</p></td>
    </tr>
    <tr>
      <th>target_data</th>
      <td><p>A table giving population proportions for groups by local
geographic area and time period. See details below.</p></td>
    </tr>
    <tr>
      <th>raking</th>
      <td><p>A formula or list of formulas specifying the variables on which
to rake survey weights.</p></td>
    </tr>
    <tr>
      <th>weight_name</th>
      <td><p>A variable giving survey weights.</p></td>
    </tr>
    <tr>
      <th>proportion_name</th>
      <td><p>The variable giving population proportions
for strata in <code>target_data</code>.</p></td>
    </tr>
    <tr>
      <th>aggregate_data</th>
      <td><p>A table of trial and success counts by group and item.
See details below.</p></td>
    </tr>
    <tr>
      <th>aggregate_item_names</th>
      <td><p>A subset of values of the <code>item</code> variable in
<code>aggregate_data</code>, for restricting the aggregate data.</p></td>
    </tr>
    <tr>
      <th>constant_item</th>
      <td><p>Whether item difficulty parameters should be constant
over time.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>dgirtIn</code> expected by <code><a href='dgirt.html'>dgirt</a></code> and
<code><a href='dgirt.html'>dgmrp</a></code>.</p>
    
    <h2 class="hasAnchor" id="item-response-data"><a class="anchor" href="#item-response-data"></a>Item Response Data</h2>

    
    <p>Individual-level data giving item responses is expected as argument
<code>item_data</code>. Required arguments <code>time_name</code> and <code>geo_name</code>
give the names of variables in <code>item_data</code> that indicate time period and
local geographic area. Optional argument <code>group_names</code> gives other
respondent characteristics to be modeled. <code>item_data</code> is optional if
argument <code>aggregate_data</code> is used. Note that the <code>dgirt()</code> model
assumes consistent coding of the polarity of item responses for
identification.</p>
    
    <h2 class="hasAnchor" id="modifier-data"><a class="anchor" href="#modifier-data"></a>Modifier Data</h2>

    
    <p>Data for modeling geographic hierarchical parameters can be given with
argument <code>modifier_data</code>, in which case argument <code>modifier_names</code>
is required and arguments <code>t1_modifier_names</code> and <code>standardize</code> are
optional.</p>
    
    <h2 class="hasAnchor" id="aggregate-item-response-data"><a class="anchor" href="#aggregate-item-response-data"></a>Aggregate Item Response Data</h2>

    <p><code>shape()</code> aggregates the individual-level item response data given as
<code>item_data</code> for modeling. Data already aggregated to the group level can
be provided with argument <code>aggregate_data</code>.</p>
<p>The data given by <code>aggregate_data</code> must be in a long table of trial and
success counts indexed by item, group, and time period. The variable names
given by arguments <code>group_names</code>, <code>geo_name</code>, and<code>time_name</code>
should exist in <code>aggregate_data</code>. Three fixed variable names must also
appear in <code>aggregate_data</code>: <code>item</code> giving item identifiers,
<code>n_grp</code> giving counts of item-response trials, and <code>s_grp</code> giving
counts of item-response successes. These counts should be adjusted
consistently with the transformations applied during the aggregation by
<code>shape()</code> of the individual <code>item_data</code>.</p>
    
    <h2 class="hasAnchor" id="reweighting"><a class="anchor" href="#reweighting"></a>Reweighting</h2>

    
    <p>Use argument <code>target_data</code> to adjust the weighting of groups toward
population targets via raking, using an adaptation of
<code><a href='http://www.rdocumentation.org/packages/survey/topics/rake'>rake</a></code>. To adjust individual survey weights in
<code>item_data</code>, provide argument <code>weight_name</code>. Otherwise,
observations in <code>item_data</code> will be assigned equal starting weights.
Argument <code>raking</code> defines strata. Argument <code>proportion_name</code>
is optional.</p>
    
    <h2 class="hasAnchor" id="restrictions"><a class="anchor" href="#restrictions"></a>Restrictions</h2>

    
    <p>For convenience, data in <code>item_data</code>, <code>modifier_data</code>,
<code>aggregate_data</code>, and <code>target_data</code> can be restricted (subsetted)
row-wise to the time periods given by argument <code>time_filter</code> and the
local geographic areas given by argument <code>geo_filter</code>.</p>
<p>Data can also be filtered column-wise to retain item variables that appear in
a minimum of time periods, using argument <code>min_t_filter</code>, or a minimum
of surveys, with argument <code>min_survey_filter</code>. Argument
<code>survey_name</code> is required when filtering by survey.</p>
<p>If both row-wise and column-wise restrictions are specified, <code>shape</code>
iterates over them until they leave the data unchanged.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># model individual item responses</span>
<span class='no'>shaped_responses</span> <span class='kw'>&lt;-</span> <span class='fu'>shape</span>(<span class='no'>opinion</span>, <span class='kw'>item_names</span> <span class='kw'>=</span> <span class='st'>"abortion"</span>, <span class='kw'>time_name</span> <span class='kw'>=</span>
  <span class='st'>"year"</span>, <span class='kw'>geo_name</span> <span class='kw'>=</span> <span class='st'>"state"</span>, <span class='kw'>group_names</span> <span class='kw'>=</span> <span class='st'>"race3"</span>)</div><div class='output co'>#&gt; <span class='message'>Applying restrictions, pass 1...</span></div><div class='output co'>#&gt; <span class='message'>	Dropped 5 rows for missingness in covariates</span></div><div class='output co'>#&gt; <span class='message'>	Dropped 3743 rows for lacking item responses</span></div><div class='output co'>#&gt; <span class='message'>Applying restrictions, pass 2...</span></div><div class='output co'>#&gt; <span class='message'>	No changes</span></div><div class='input'>
<span class='co'># summarize result)</span>
<span class='fu'><a href='dgirtin-class.html'>summary</a></span>(<span class='no'>shaped_responses</span>)</div><div class='output co'>#&gt; Items:
#&gt; [1] "abortion"
#&gt; Respondents:
#&gt;    144,250 in `item_data`
#&gt; Grouping variables:
#&gt; [1] "year"  "state" "race3"
#&gt; Time periods:
#&gt; [1] 2006 2007 2008 2009 2010
#&gt; Local geographic areas:
#&gt;  [1] "AK" "AL" "AR" "AZ" "CA" "CO" "CT" "DC" "DE" "FL" "GA" "HI" "IA" "ID" "IL"
#&gt; [16] "IN" "KS" "KY" "LA" "MA" "MD" "ME" "MI" "MN" "MO" "MS" "MT" "NC" "ND" "NE"
#&gt; [31] "NH" "NJ" "NM" "NV" "NY" "OH" "OK" "OR" "PA" "RI" "SC" "SD" "TN" "TX" "UT"
#&gt; [46] "VA" "VT" "WA" "WI" "WV" "WY"
#&gt; Hierarchical parameters:
#&gt;  [1] "AL"         "AR"         "AZ"         "CA"         "CO"        
#&gt;  [6] "CT"         "DC"         "DE"         "FL"         "GA"        
#&gt; [11] "HI"         "IA"         "ID"         "IL"         "IN"        
#&gt; [16] "KS"         "KY"         "LA"         "MA"         "MD"        
#&gt; [21] "ME"         "MI"         "MN"         "MO"         "MS"        
#&gt; [26] "MT"         "NC"         "ND"         "NE"         "NH"        
#&gt; [31] "NJ"         "NM"         "NV"         "NY"         "OH"        
#&gt; [36] "OK"         "OR"         "PA"         "RI"         "SC"        
#&gt; [41] "SD"         "TN"         "TX"         "UT"         "VA"        
#&gt; [46] "VT"         "WA"         "WI"         "WV"         "WY"        
#&gt; [51] "race3other" "race3white"
#&gt; Modifiers of hierarchical parameters:
#&gt; NULL
#&gt; Constants:
#&gt;   Q   T   P   N   G   H   D 
#&gt;   1   5  52 765 153   1   1 </div><div class='input'>
<span class='co'># check sparseness of data to be modeled</span>
<span class='fu'><a href='dgirtin-class.html'>get_item_n</a></span>(<span class='no'>shaped_responses</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"year"</span>)</div><div class='output co'>#&gt;    year abortion
#&gt; 1: 2006    33514
#&gt; 2: 2007     9258
#&gt; 3: 2008    32634
#&gt; 4: 2009    13718
#&gt; 5: 2010    55126</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#item-response-data">Item Response Data</a></li>

      <li><a href="#modifier-data">Modifier Data</a></li>

      <li><a href="#aggregate-item-response-data">Aggregate Item Response Data</a></li>

      <li><a href="#reweighting">Reweighting</a></li>

      <li><a href="#restrictions">Restrictions</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://jdunham.io'>James Dunham</a>, <a href='http://caughey.mit.edu/welcome'>Devin Caughey</a>, <a href='http://cwarshaw.scripts.mit.edu/'>Christopher Warshaw</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
