<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • dgo</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">dgo</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Introduction</a>
</li>
<li>
  <a href="../articles/abortion_attitudes.html">Abortion Attitudes</a>
</li>
<li>
  <a href="../articles/policy_liberalism.html">Policy Liberalism</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/jamesdunham/dgo">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<div id="policy-liberalism" class="section level1">
<h1 class="hasAnchor">
<a href="#policy-liberalism" class="anchor"></a>Policy Liberalism</h1>
<div id="prepare-input-data-with-shape" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-input-data-with-shape" class="anchor"></a>Prepare input data with <code>shape</code>
</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dgo)</code></pre></div>
<pre><code>## Loading required package: dgodata</code></pre>
<pre><code>## Loading required package: rstan</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Loading required package: StanHeaders</code></pre>
<pre><code>## rstan (Version 2.15.1, packaged: 2017-04-19 05:03:57 UTC, GitRev: 2e1f913d3ca3)</code></pre>
<pre><code>## For execution on a local, multicore CPU with excess RAM we recommend calling
## rstan_options(auto_write = TRUE)
## options(mc.cores = parallel::detectCores())</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dgirt_in_liberalism &lt;-<span class="st"> </span><span class="kw"><a href="../reference/shape.html">shape</a></span>(opinion, <span class="dt">item_names =</span> <span class="kw">c</span>(<span class="st">"abortion"</span>,
    <span class="st">"affirmative_action"</span>,<span class="st">"stemcell_research"</span> , <span class="st">"gaymarriage_amendment"</span>,
    <span class="st">"partialbirth_abortion"</span>) , <span class="dt">time_name =</span> <span class="st">"year"</span>, <span class="dt">geo_name =</span> <span class="st">"state"</span>,
  <span class="dt">group_names =</span> <span class="st">"race3"</span>, <span class="dt">geo_filter =</span> <span class="kw">c</span>(<span class="st">"CA"</span>, <span class="st">"GA"</span>, <span class="st">"LA"</span>, <span class="st">"MA"</span>))</code></pre></div>
<pre><code>## Applying restrictions, pass 1...</code></pre>
<pre><code>##  Dropped 5 rows for missingness in covariates</code></pre>
<pre><code>##  Dropped 8 rows for lacking item responses</code></pre>
<pre><code>## Applying restrictions, pass 2...</code></pre>
<pre><code>##  No changes</code></pre>
<p>The reshaped and subsetted data can be summarized in a few ways before model fitting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">summary</a></span>(dgirt_in_liberalism)</code></pre></div>
<pre><code>## Items:
## [1] "abortion"              "affirmative_action"    "gaymarriage_amendment"
## [4] "partialbirth_abortion" "stemcell_research"    
## Respondents:
##    23,632 in `item_data`
## Grouping variables:
## [1] "year"  "state" "race3"
## Time periods:
## [1] 2006 2007 2008 2009 2010
## Local geographic areas:
## [1] "CA" "GA" "LA" "MA"
## Hierarchical parameters:
## [1] "GA"         "LA"         "MA"         "race3other" "race3white"
## Modifiers of hierarchical parameters:
## NULL
## Constants:
##   Q   T   P   N   G   H   D 
##   5   5   5 300  12   1   1</code></pre>
<p>Response counts by item-year:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">get_item_n</a></span>(dgirt_in_liberalism, <span class="dt">by =</span> <span class="st">"year"</span>)</code></pre></div>
<pre><code>##    year abortion affirmative_action stemcell_research
## 1: 2006     5275               4750              2483
## 2: 2007     1690               1557              1705
## 3: 2008     4697               4704              4002
## 4: 2009     2141               2147                 0
## 5: 2010     9204               9241              9146
##    gaymarriage_amendment partialbirth_abortion
## 1:                  2642                  5064
## 2:                  1163                  1684
## 3:                  4265                     0
## 4:                     0                     0
## 5:                  9226                     0</code></pre>
</div>
<div id="fit-a-model-with-dgirt" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-a-model-with-dgirt" class="anchor"></a>Fit a model with <code>dgirt</code>
</h2>
<p><code><a href="../reference/dgirt.html">dgirt()</a></code> and <code><a href="../reference/dgirt.html">dgmrp()</a></code> fit estimation models to data from <code><a href="../reference/shape.html">shape()</a></code>. <code><a href="../reference/dgirt.html">dgirt()</a></code> can be used to estimate a latent variable based on responses to multiple survey questions (e.g., latent policy conservatism), while <code><a href="../reference/dgirt.html">dgmrp()</a></code> can be used to estimate public opinion on an individual survey question using a dynamic multi-level regression and post-stratification (MRP) model.</p>
<p>Under the hood, these functions use RStan for MCMC sampling, and arguments can be passed to RStan’s <a href="https://www.rdocumentation.org/packages/rstan/versions/2.15.1/topics/stan"><code>stan()</code></a> via the <code>...</code> argument of <code>dgirt</code> and <code>dgmrp</code>. This will almost always be desirable, at a minimum to specify the number of sampler iterations, chains, and cores.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dgirt_out_liberalism &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dgirt.html">dgirt</a></span>(dgirt_in_liberalism, <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">chains =</span> <span class="dv">4</span>,
  <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">seed =</span> <span class="dv">42</span>)</code></pre></div>
<p>The model results are held in a <code>dgirtfit</code> object. Methods from RStan like <code>extract</code> are available if needed because <code>dgirtfit</code> is a subclass of <code>stanfit</code>. But dgo provides its own methods for typical post-estimation tasks.</p>
</div>
<div id="work-with-dgirt-results" class="section level2">
<h2 class="hasAnchor">
<a href="#work-with-dgirt-results" class="anchor"></a>Work with <code>dgirt</code> results</h2>
<p>For a high-level summary of the result, use <code>summary</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">summary</a></span>(dgirt_out_liberalism)</code></pre></div>
<pre><code>## dgirt samples from 4 chains of 3000 iterations, 1500 warmup, thinned every 1 
##   Drawn Mon May 22 21:01:02 2017 
##   Package version 0.2.9 
##   Model version 2017_01_04 
##   137 parameters; 60 theta_bars (year state race3)
##   5 periods 2006 to 2010 
## 
## n_eff</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   65.07  388.19  585.84 1083.11 1245.79 6000.00</code></pre>
<pre><code>## 
## Rhat</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.9997  1.0020  1.0059  1.0084  1.0119  1.0553</code></pre>
<pre><code>## 
## Elapsed time</code></pre>
<pre><code>##    chain warmup sample  total
## 1:     1 2M 11S 1M 55S 3M 66S
## 2:     2 1M 60S 3M 32S 4M 92S
## 3:     3 2M 21S 3M 21S 5M 42S
## 4:     4 2M 24S 3M 27S 5M 51S</code></pre>
<p>To summarize posterior samples, use <a href="https://jdunham.io/dgo/reference/dgo_fit-methods.html"><code><a href="../reference/dgo_fit-methods.html">summarize()</a></code></a>. The default output gives summary statistics for the <code>theta_bar</code> parameters, which represent the mean of the latent outcome for the groups defined by time, local geographic area, and the demographic characteristics specified in the earlier call to <code><a href="../reference/shape.html">shape()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw"><a href="../reference/dgo_fit-methods.html">summarize</a></span>(dgirt_out_liberalism))</code></pre></div>
<pre><code>##        param state race3 year      mean         sd    median      q_025
## 1: theta_bar    CA black 2006 0.5247367 0.06827003 0.5194593 0.40423566
## 2: theta_bar    CA black 2007 0.5944296 0.08813494 0.5853362 0.44776239
## 3: theta_bar    CA black 2008 0.5823158 0.10139495 0.5667726 0.43013247
## 4: theta_bar    CA black 2009 0.5132426 0.08060875 0.5021405 0.38781331
## 5: theta_bar    CA black 2010 0.4977903 0.05987256 0.4922105 0.39645056
## 6: theta_bar    CA other 2006 0.1593904 0.05938098 0.1664194 0.02339847
##        q_975
## 1: 0.6754660
## 2: 0.7932721
## 3: 0.8190219
## 4: 0.7062299
## 5: 0.6332728
## 6: 0.2583196</code></pre>
<p>Alternatively, <a href="https://jdunham.io/dgo/reference/dgo_fit-methods.html"><code><a href="../reference/dgo_fit-methods.html">summarize()</a></code></a> can apply arbitrary functions to posterior samples for whatever parameter is given by its <code>pars</code> argument. Enclose function names with quotes. For convenience, <code>"q_025"</code> and <code>"q_975"</code> give the 2.5th and 97.5th posterior quantiles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgo_fit-methods.html">summarize</a></span>(dgirt_out_liberalism, <span class="dt">pars =</span> <span class="st">"xi"</span>, <span class="dt">funs =</span> <span class="st">"var"</span>)</code></pre></div>
<pre><code>##    param year         var
## 1:    xi 2006 0.013076032
## 2:    xi 2007 0.008053516
## 3:    xi 2008 0.006789127
## 4:    xi 2009 0.006144990
## 5:    xi 2010 0.005945176</code></pre>
<p>To access posterior samples in tabular form use <a href="https://jdunham.io/dgo/reference/dgo_fit-methods.html"><code>as.data.frame()</code></a>. By default, this method returns post-warmup samples for the <code>theta_bar</code> parameters, but like other methods takes a <code>pars</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">as.data.frame</span>(dgirt_out_liberalism))</code></pre></div>
<pre><code>##        param state race3 year iteration     value
## 1: theta_bar    CA black 2006         1 0.6107959
## 2: theta_bar    CA black 2006         2 0.4745799
## 3: theta_bar    CA black 2006         3 0.4980549
## 4: theta_bar    CA black 2006         4 0.4898826
## 5: theta_bar    CA black 2006         5 0.4939210
## 6: theta_bar    CA black 2006         6 0.4746524</code></pre>
<p>To poststratify the results use <code><a href="../reference/poststratify.html">poststratify()</a></code>. The following example uses the group population proportions bundled as <code>annual_state_race_targets</code> to reweight and aggregate estimates to strata defined by state-years. Read <code>help("poststratify")</code> for more details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/poststratify.html">poststratify</a></span>(dgirt_out_liberalism, annual_state_race_targets, <span class="dt">strata_names =</span> <span class="kw">c</span>(<span class="st">"state"</span>,
    <span class="st">"year"</span>), <span class="dt">aggregated_names =</span> <span class="st">"race3"</span>)</code></pre></div>
<pre><code>##     state year        value
##  1:    CA 2006  0.143321712
##  2:    CA 2007  0.188969603
##  3:    CA 2008  0.112907172
##  4:    CA 2009  0.058219329
##  5:    CA 2010  0.092557709
##  6:    GA 2006  0.103355439
##  7:    GA 2007  0.084458691
##  8:    GA 2008 -0.011351441
##  9:    GA 2009 -0.015584764
## 10:    GA 2010  0.010578655
## 11:    LA 2006  0.021248643
## 12:    LA 2007 -0.003170117
## 13:    LA 2008 -0.095756506
## 14:    LA 2009 -0.124279123
## 15:    LA 2010 -0.088613763
## 16:    MA 2006  0.147235550
## 17:    MA 2007  0.269984992
## 18:    MA 2008  0.159194876
## 19:    MA 2009  0.082495757
## 20:    MA 2010  0.122864118</code></pre>
<p>To plot the results use <code><a href="../reference/plot-method.html">dgirt_plot()</a></code>. This method plots summaries of posterior samples by time period. By default, it shows a 95% credible interval around posterior medians for the <code>theta_bar</code> parameters, for each local geographic area. For this (unconverged) toy example we omit the CIs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot-method.html">dgirt_plot</a></span>(dgirt_out_liberalism, <span class="dt">y_min =</span> <span class="ot">NULL</span>, <span class="dt">y_max =</span> <span class="ot">NULL</span>)</code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/jamesdunham/dgo/master/README/dgirt_plot-1.png">
</div>
<p><code><a href="../reference/plot-method.html">dgirt_plot()</a></code> can also plot the <code>data.frame</code> output from <code><a href="../reference/poststratify.html">poststratify()</a></code>. This requires arguments that identify the relevant variables in the <code>data.frame</code>. Below, <code><a href="../reference/poststratify.html">poststratify()</a></code> aggregates over the demographic grouping variable <code>race3</code>, resulting in a <code>data.frame</code> of estimates by state-year. So, in the subsequent call to <code><a href="../reference/plot-method.html">dgirt_plot()</a></code>, we pass the names of the state and year variables. The <code>group_names</code> argument is <code>NULL</code> because there are no grouping variables left after aggregating over <code>race3</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/poststratify.html">poststratify</a></span>(dgirt_out_liberalism, annual_state_race_targets, <span class="dt">strata_names =</span> <span class="kw">c</span>(<span class="st">"state"</span>,
    <span class="st">"year"</span>), <span class="dt">aggregated_names =</span> <span class="st">"race3"</span>)
<span class="kw">head</span>(ps)</code></pre></div>
<pre><code>##    state year      value
## 1:    CA 2006 0.14332171
## 2:    CA 2007 0.18896960
## 3:    CA 2008 0.11290717
## 4:    CA 2009 0.05821933
## 5:    CA 2010 0.09255771
## 6:    GA 2006 0.10335544</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot-method.html">dgirt_plot</a></span>(ps, <span class="dt">group_names =</span> <span class="ot">NULL</span>, <span class="dt">time_name =</span> <span class="st">"year"</span>, <span class="dt">geo_name =</span> <span class="st">"state"</span>)</code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/jamesdunham/dgo/master/README/dgirt_plot_ps-1.png">
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#policy-liberalism">Policy Liberalism</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prepare-input-data-with-shape">Prepare input data with <code>shape</code></a></li>
      <li><a href="#fit-a-model-with-dgirt">Fit a model with <code>dgirt</code></a></li>
      <li><a href="#work-with-dgirt-results">Work with <code>dgirt</code> results</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://jdunham.io">James Dunham</a>, <a href="http://caughey.mit.edu/welcome">Devin Caughey</a>, <a href="http://cwarshaw.scripts.mit.edu/">Christopher Warshaw</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
