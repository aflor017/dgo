<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • dgo</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">dgo</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Introduction</a>
</li>
<li>
  <a href="../articles/abortion_attitudes.html">Abortion Attitudes</a>
</li>
<li>
  <a href="../articles/policy_liberalism.html">Policy Liberalism</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/jamesdunham/dgo">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<div id="abortion-attitudes" class="section level1">
<h1 class="hasAnchor">
<a href="#abortion-attitudes" class="anchor"></a>Abortion Attitudes</h1>
<div id="prepare-input-data-with-shape" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-input-data-with-shape" class="anchor"></a>Prepare input data with <code>shape</code>
</h2>
<p>DGIRT models are <em>dynamic</em>, so we need to specify which variable in the data represents time. They are also <em>group-level</em>, with groups defined by one variable for respondents’ local geographic area and one or more variables for respondent characteristics.</p>
<p>The <code>time_filter</code> and <code>geo_filter</code> arguments optionally subset the data. Finally, <code><a href="../reference/shape.html">shape()</a></code> requires the names of the survey identifier and survey weight variables in the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dgo)
dgirt_in_abortion &lt;-<span class="st"> </span><span class="kw"><a href="../reference/shape.html">shape</a></span>(opinion,
                  <span class="dt">item_names =</span> <span class="st">"abortion"</span>,
                  <span class="dt">time_name =</span> <span class="st">"year"</span>,
                  <span class="dt">geo_name =</span> <span class="st">"state"</span>,
                  <span class="dt">group_names =</span> <span class="st">"race3"</span>,
                  <span class="dt">geo_filter =</span> <span class="kw">c</span>(<span class="st">"CA"</span>, <span class="st">"GA"</span>, <span class="st">"LA"</span>, <span class="st">"MA"</span>),
                  <span class="dt">id_vars =</span> <span class="st">"source"</span>)</code></pre></div>
<p>The reshaped and subsetted data can be summarized in a few ways before model fitting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">summary</a></span>(dgirt_in_abortion)</code></pre></div>
<pre><code>## Items:
## [1] "abortion"
## Respondents:
##    23,007 in `item_data`
## Grouping variables:
## [1] "year"  "state" "race3"
## Time periods:
## [1] 2006 2007 2008 2009 2010
## Local geographic areas:
## [1] "CA" "GA" "LA" "MA"
## Hierarchical parameters:
## [1] "GA"         "LA"         "MA"         "race3other" "race3white"
## Modifiers of hierarchical parameters:
## NULL
## Constants:
##  Q  T  P  N  G  H  D 
##  1  5  5 60 12  1  1</code></pre>
<p>Response counts by state:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">get_n</a></span>(dgirt_in_abortion, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"state"</span>))</code></pre></div>
<pre><code>##    state     n
## 1:    CA 14248
## 2:    GA  4547
## 3:    LA  1658
## 4:    MA  2554</code></pre>
<p>Response counts by item-year:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">get_item_n</a></span>(dgirt_in_abortion, <span class="dt">by =</span> <span class="st">"year"</span>)</code></pre></div>
<pre><code>##    year abortion
## 1: 2006     5275
## 2: 2007     1690
## 3: 2008     4697
## 4: 2009     2141
## 5: 2010     9204</code></pre>
</div>
<div id="fit-a-model-with-dgirt-or-dgmrp" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-a-model-with-dgirt-or-dgmrp" class="anchor"></a>Fit a model with <code>dgirt</code> or <code>dgmrp</code>
</h2>
<p><code><a href="../reference/dgirt.html">dgirt()</a></code> and <code><a href="../reference/dgirt.html">dgmrp()</a></code> fit estimation models to data from <code><a href="../reference/shape.html">shape()</a></code>. <code><a href="../reference/dgirt.html">dgirt()</a></code> can be used to estimate a latent variable based on responses to multiple survey questions (e.g., latent policy conservatism), while <code>dgmrp</code> can be used to estimate public opinion on an individual survey question (e.g., abortion) using a dynamic multi-level regression and post-stratification (MRP) model. In this case, we use <code><a href="../reference/dgirt.html">dgmrp()</a></code> to model abortion attitudes.</p>
<p>Under the hood, these functions use RStan for MCMC sampling, and arguments can be passed to RStan’s <a href="https://www.rdocumentation.org/packages/rstan/versions/2.15.1/topics/stan"><code>stan()</code></a> via the <code>...</code> argument of <code><a href="../reference/dgirt.html">dgirt()</a></code> and <code><a href="../reference/dgirt.html">dgmrp()</a></code>. This will almost always be desirable, at a minimum to specify the number of sampler iterations, chains, and cores.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dgmrp_out_abortion &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dgirt.html">dgmrp</a></span>(dgirt_in_abortion, <span class="dt">iter =</span> <span class="dv">1500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span>
  <span class="dv">4</span>, <span class="dt">seed =</span> <span class="dv">42</span>)</code></pre></div>
<p>The model results are held in a <code>dgirtfit</code> object. Methods from RStan like <code>extract</code> are available if needed because <code>dgirtfit</code> is a subclass of <code>stanfit</code>. But dgo provides its own methods for typical post-estimation tasks.</p>
</div>
<div id="work-with-dgmrp-results" class="section level2">
<h2 class="hasAnchor">
<a href="#work-with-dgmrp-results" class="anchor"></a>Work with <code>dgmrp</code> results</h2>
<p>For a high-level summary of the result, use <code>summary</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgirtin-class.html">summary</a></span>(dgmrp_out_abortion)</code></pre></div>
<pre><code>## dgirt samples from 4 chains of 1500 iterations, 750 warmup, thinned every 1 
##   Drawn Mon May 22 20:53:30 2017 
##   Package version 0.2.9 
##   Model version 2017_01_04_singleissue 
##   117 parameters; 60 theta_bars (year state race3)
##   5 periods 2006 to 2010 
## 
## n_eff</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   95.68  242.50  451.87  685.85  927.30 3000.00</code></pre>
<pre><code>## 
## Rhat</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.9993  1.0028  1.0068  1.0081  1.0126  1.0406</code></pre>
<pre><code>## 
## Elapsed time</code></pre>
<pre><code>##    chain warmup sample total
## 1:     1    14S    16S   30S
## 2:     2    14S    11S   25S
## 3:     3    14S    19S   33S
## 4:     4    16S    12S   28S</code></pre>
<p>To summarize posterior samples, use <a href="https://jdunham.io/dgo/reference/dgo_fit-methods.html"><code><a href="../reference/dgo_fit-methods.html">summarize()</a></code></a>. The default output gives summary statistics for the <code>theta_bar</code> parameters, which represent the mean of the latent outcome for the groups defined by time, local geographic area, and the demographic characteristics specified in the earlier call to <code><a href="../reference/shape.html">shape()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw"><a href="../reference/dgo_fit-methods.html">summarize</a></span>(dgmrp_out_abortion))</code></pre></div>
<pre><code>##        param state race3 year      mean         sd    median     q_025
## 1: theta_bar    CA black 2006 0.7739283 0.02098019 0.7749083 0.7307567
## 2: theta_bar    CA black 2007 0.7980027 0.02771553 0.7979378 0.7439328
## 3: theta_bar    CA black 2008 0.7232980 0.02362116 0.7231930 0.6786121
## 4: theta_bar    CA black 2009 0.6863666 0.02128237 0.6863458 0.6463628
## 5: theta_bar    CA black 2010 0.7407779 0.01682742 0.7414667 0.7058706
## 6: theta_bar    CA other 2006 0.7347199 0.02322850 0.7354365 0.6872140
##        q_975
## 1: 0.8144084
## 2: 0.8517811
## 3: 0.7693334
## 4: 0.7279652
## 5: 0.7717651
## 6: 0.7790182</code></pre>
<p>Alternatively, <a href="https://jdunham.io/dgo/reference/dgo_fit-methods.html"><code><a href="../reference/dgo_fit-methods.html">summarize()</a></code></a> can apply arbitrary functions to posterior samples for whatever parameter is given by its <code>pars</code> argument. Enclose function names with quotes. For convenience, <code>"q_025"</code> and <code>"q_975"</code> give the 2.5th and 97.5th posterior quantiles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/dgo_fit-methods.html">summarize</a></span>(dgmrp_out_abortion, <span class="dt">pars =</span> <span class="st">"xi"</span>, <span class="dt">funs =</span> <span class="st">"var"</span>)</code></pre></div>
<pre><code>##    param year        var
## 1:    xi 2006 0.01814362
## 2:    xi 2007 0.05026942
## 3:    xi 2008 0.05606188
## 4:    xi 2009 0.04857038
## 5:    xi 2010 0.04149793</code></pre>
<p>To access posterior samples in tabular form use <a href="https://jdunham.io/dgo/reference/dgo_fit-methods.html"><code>as.data.frame()</code></a>. By default, this method returns post-warmup samples for the <code>theta_bar</code> parameters, but like other methods takes a <code>pars</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">as.data.frame</span>(dgmrp_out_abortion))</code></pre></div>
<pre><code>##        param state race3 year iteration     value
## 1: theta_bar    CA black 2006         1 0.7661626
## 2: theta_bar    CA black 2006         2 0.7690362
## 3: theta_bar    CA black 2006         3 0.7656257
## 4: theta_bar    CA black 2006         4 0.7935372
## 5: theta_bar    CA black 2006         5 0.7544080
## 6: theta_bar    CA black 2006         6 0.7819740</code></pre>
<p>To poststratify the results use <code><a href="../reference/poststratify.html">poststratify()</a></code>. The following example uses the group population proportions bundled as <code>annual_state_race_targets</code> to reweight and aggregate estimates to strata defined by state-years.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/poststratify.html">poststratify</a></span>(dgmrp_out_abortion, annual_state_race_targets, <span class="dt">strata_names =</span>
  <span class="kw">c</span>(<span class="st">"state"</span>, <span class="st">"year"</span>), <span class="dt">aggregated_names =</span> <span class="st">"race3"</span>)</code></pre></div>
<pre><code>##     state year     value
##  1:    CA 2006 0.7187353
##  2:    CA 2007 0.7469064
##  3:    CA 2008 0.6562966
##  4:    CA 2009 0.6272075
##  5:    CA 2010 0.6754691
##  6:    GA 2006 0.6339750
##  7:    GA 2007 0.6225482
##  8:    GA 2008 0.5232615
##  9:    GA 2009 0.5095145
## 10:    GA 2010 0.5705449
## 11:    LA 2006 0.5266416
## 12:    LA 2007 0.4769044
## 13:    LA 2008 0.4142786
## 14:    LA 2009 0.3985367
## 15:    LA 2010 0.4229707
## 16:    MA 2006 0.7629194
## 17:    MA 2007 0.8099707
## 18:    MA 2008 0.7058450
## 19:    MA 2009 0.6624888
## 20:    MA 2010 0.7078342</code></pre>
<p>To plot the results use <code><a href="../reference/plot-method.html">dgirt_plot()</a></code>. This method plots summaries of posterior samples by time period. By default, it shows a 95% credible interval around posterior medians for the <code>theta_bar</code> parameters, for each local geographic area. For this (unconverged) toy example we omit the CIs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot-method.html">dgirt_plot</a></span>(dgmrp_out_abortion, <span class="dt">y_min =</span> <span class="ot">NULL</span>, <span class="dt">y_max =</span> <span class="ot">NULL</span>)</code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/jamesdunham/dgo/master/README/dgmrp_plot-1.png">
</div>
<p>Output from <code><a href="../reference/plot-method.html">dgirt_plot()</a></code> can be customized to some extent using objects from the ggplot2 package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot-method.html">dgirt_plot</a></span>(dgmrp_out_abortion, <span class="dt">y_min =</span> <span class="ot">NULL</span>, <span class="dt">y_max =</span> <span class="ot">NULL</span>) +<span class="st"> </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><img src="https://raw.githubusercontent.com/jamesdunham/dgo/master/README/dgmrp_plot_plus-1.png" width="100%"></p>
<p><code><a href="../reference/plot-method.html">dgirt_plot()</a></code> can also plot the <code>data.frame</code> output from <code><a href="../reference/poststratify.html">poststratify()</a></code>. This requires arguments that identify the relevant variables in the <code>data.frame</code>. Below, <code><a href="../reference/poststratify.html">poststratify()</a></code> aggregates over the demographic grouping variable <code>race3</code>, resulting in a <code>data.frame</code> of estimates by state-year. So, in the subsequent call to <code><a href="../reference/plot-method.html">dgirt_plot()</a></code>, we pass the names of the state and year variables. The <code>group_names</code> argument is <code>NULL</code> because there are no grouping variables left after aggregating over <code>race3</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/poststratify.html">poststratify</a></span>(dgmrp_out_abortion, annual_state_race_targets, <span class="dt">strata_names =</span>
  <span class="kw">c</span>(<span class="st">"state"</span>, <span class="st">"year"</span>), <span class="dt">aggregated_names =</span> <span class="st">"race3"</span>)
<span class="kw">head</span>(ps)</code></pre></div>
<pre><code>##    state year     value
## 1:    CA 2006 0.7187353
## 2:    CA 2007 0.7469064
## 3:    CA 2008 0.6562966
## 4:    CA 2009 0.6272075
## 5:    CA 2010 0.6754691
## 6:    GA 2006 0.6339750</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot-method.html">dgirt_plot</a></span>(ps, <span class="dt">group_names =</span> <span class="ot">NULL</span>, <span class="dt">time_name =</span> <span class="st">"year"</span>, <span class="dt">geo_name =</span> <span class="st">"state"</span>)</code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/jamesdunham/dgo/master/README/dgmrp_plot_ps-1.png">
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#abortion-attitudes">Abortion Attitudes</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prepare-input-data-with-shape">Prepare input data with <code>shape</code></a></li>
      <li><a href="#fit-a-model-with-dgirt-or-dgmrp">Fit a model with <code>dgirt</code> or <code>dgmrp</code></a></li>
      <li><a href="#work-with-dgmrp-results">Work with <code>dgmrp</code> results</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://jdunham.io">James Dunham</a>, <a href="http://caughey.mit.edu/welcome">Devin Caughey</a>, <a href="http://cwarshaw.scripts.mit.edu/">Christopher Warshaw</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
